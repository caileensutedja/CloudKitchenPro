<div class="row">
    <div class="text-center">
        <h2 style="font-weight: bold;">
            üìÇRecipe CollectionüìÇ
        </h2>
        <div style="text-align: right;" class="md-3">
            <button class="btn btn-dark" routerLink="/34375783/recipe/add">Add Recipe</button>
        </div>
    </div>
    <h6 class="text-center">Total recipes in collection: {{count}}</h6>

    <!-- Recipe Collection -->
    <div class="container">
        <h2>All Recipes:</h2>
        @if(message.length > 0){
            <div class="alert alert-success">
                {{message}}
            </div>
        }
        @if(errorMessage !== ''){
            <div class="alert alert-danger">
                {{errorMessage}}
            </div>
        }
        @if(recipes.length === 0) {
            <p class="text-muted">No recipes available.</p>
        }@else{
        <div class="row g-3">
          @for(recipe of recipes; track $index){
            <div class="col-md-4">
              <div class="card h-100 text-black">
                <div class="card-body d-flex flex-column">
                  <h5 class="card-title"><strong>{{recipe.title}}</strong></h5>
                  <h6 class="card-subtitle mb-2 fs-6 text-muted">by {{recipe.chef}}</h6>
                  <p class="card-text">
                    <strong>Meal Type:</strong> {{recipe.mealType}}<br>
                    <strong>Cuisine:</strong> {{recipe.cuisineType}}<br>
                    <strong>Prep Time:</strong> {{recipe.prepTime}} minutes<br>
                    <strong>Difficulty:</strong> {{recipe.difficulty}}<br>
                    <strong>Servings:</strong> {{recipe.servings}}<br>
                    <br>
                    <strong>Ingredients:</strong> {{recipe.ingredients.length}} items<br>
                    <strong>Instructions:</strong> {{recipe.instructions.length}} steps<br>
                    <strong>Created:</strong> {{recipe.createdAt | date:'yyyy-MM-dd'}}
                  </p>
                </div>
                <div class="card-footer d-flex justify-content-between">
                  <button class="btn btn-primary btn-sm" (click)="viewRecipe(recipe._id)">View</button>
                  @if(userId === recipe.userIdString){
                  <button class="btn btn-warning btn-sm" (click)="openFormDialog(formModal, recipe._id)">Edit</button>
                  <button class="btn btn-danger btn-sm" (click)="openConfirmationDialog(confirmationModal, recipe._id)">Delete</button>
                  }
                </div>
              </div>
            </div>
          }
        </div> 
        }
    </div>
</div>

<ng-template #confirmationModal let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">Confirmation of Deletion</h4>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
  </div>
  <div class="modal-body">
    <p>Are you sure you want to delete this recipe?</p>
    <p><small class="text-muted">This action cannot be undone.</small></p>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-danger" (click)="modal.close('yes')">Yes, Delete</button>
    <button type="button" class="btn btn-secondary" (click)="modal.close('no')">Cancel</button>
  </div>
</ng-template>

<ng-template #formModal let-modal>
  <div class="modal-header">
    <h4 class="modal-title">‚úèÔ∏è Edit Recipe</h4>
    <button type="button" class="btn-close" (click)="modal.dismiss('cancel')"></button>
  </div>

  <div class="modal-body">
    <!-- Title -->
    <div class="mb-3">
      <label class="form-label fw-bold fs-5">Title</label>
      <input type="text" class="form-control" [(ngModel)]="editRecipeContent.title" name="title" required>
    </div>

    <!-- Ingredients -->
    <div class="mb-3">
      <label class="form-label fw-bold fs-5">Ingredients</label>
      <input type="text" class="form-control" [(ngModel)]="editRecipeContent.ingredients" name="ingredients" required>
    </div>

    <!-- Instructions -->
    <div class="mb-3">
      <label class="form-label fw-bold fs-5">Instructions</label>
      <input type="text" class="form-control" [(ngModel)]="editRecipeContent.instructions" name="instructions" required>
    </div>

    <!-- Meal Type -->
    <div class="mb-3">
      <label class="form-label fw-bold fs-5">Meal Type</label>
      <select class="form-control" [(ngModel)]="editRecipeContent.mealType" name="mealType" required>
        <option value="">-Select meal type-</option>
        @for(type of mealTypes; track type) {
          <option [value]="type">{{ type }}</option>
        }
      </select>
    </div>

    <!-- Cuisine Type -->
    <div class="mb-3">
      <label class="form-label fw-bold fs-5">Cuisine Type</label>
      <select class="form-control" [(ngModel)]="editRecipeContent.cuisineType" name="cuisineType" required>
        <option value="">-Select cuisine type-</option>
        @for(cuisine of cuisineTypes; track cuisine) {
          <option [value]="cuisine">{{ cuisine }}</option>
        }
      </select>
    </div>

    <!-- Prep Time -->
    <div class="mb-3">
      <label class="form-label fw-bold fs-5">Preparation Time (minutes)</label>
      <input type="number" min="0" max="480" class="form-control" [(ngModel)]="editRecipeContent.prepTime" name="prepTime" required>
    </div>

    <!-- Difficulty -->
    <div class="mb-3">
      <label class="form-label fw-bold fs-5">Difficulty</label>
      <select class="form-control" [(ngModel)]="editRecipeContent.difficulty" name="difficulty" required>
        <option value="">-Select difficulty level-</option>
        @for(level of difficultyLevels; track level) {
          <option [value]="level">{{ level }}</option>
        }
      </select>
    </div>

    <!-- Servings -->
    <div class="mb-3">
      <label class="form-label fw-bold fs-5">Servings</label>
      <input type="number" min="1" max="20" class="form-control" [(ngModel)]="editRecipeContent.servings" name="servings" required>
    </div>

  </div>

  <div class="modal-footer">
    <button type="button" class="btn btn-primary" (click)="modal.close('save')">Save Changes</button>
    <button type="button" class="btn btn-secondary" (click)="modal.dismiss('cancel')">Cancel</button>
  </div>
</ng-template>
